<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <title>听歌识曲</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- 字体文件 -->
    <link href="music_files/font-awesome.css" rel="stylesheet">
    <!-- 背景css -->
    <link href="music_files/bg.css" rel="stylesheet">
    <!-- 播放器css -->
    <link href="music_files/fcmusic.css" rel="stylesheet">
    <script src="music_files/jquery.min.js"></script>
  </head>
  
  <body>
    <!-- 网页背景部分,这个其实你可以自定义网页背景，我只是为了好看，所有用了这个 -->
    <div id="scene" class="stars-wrapper">
      <div data-depth="0.00" class="layer"></div>
      <div data-depth="0.30" class="stars-cluster stars-cluster-1">
        <div class="star star-1"></div>
        <div class="star star-2"></div>
        <div class="star star-3"></div>
        <div class="star star-4"></div>
        <div class="star star-5"></div>
        <div class="star star-6"></div>
        <div class="star star-7"></div>
        <div class="star star-8"></div>
        <div class="star star-9"></div>
        <div class="star star-10"></div>
        <div class="star star-11"></div>
        <div class="star star-12"></div>
        <div class="star star-13"></div>
        <div class="star star-14"></div>
        <div class="star star-15"></div>
        <div class="star star-16"></div>
        <div class="star star-17"></div>
        <div class="star star-18"></div>
        <div class="star star-19"></div>
        <div class="star star-20"></div>
        <div class="star star-21"></div>
        <div class="star star-22"></div>
        <div class="star star-23"></div>
        <div class="star star-24"></div>
        <div class="star star-25"></div>
        <div class="star star-26"></div>
        <div class="star star-27"></div>
        <div class="star star-28"></div>
        <div class="star star-29"></div>
        <div class="star star-30"></div>
        <div class="star star-31"></div>
        <div class="star star-32"></div>
        <div class="star star-33"></div>
        <div class="star star-34"></div>
        <div class="star star-35"></div>
        <div class="star star-36"></div>
        <div class="star star-37"></div>
        <div class="star star-38"></div>
        <div class="star star-39"></div>
        <div class="star star-40"></div>
      </div>
      <div data-depth="0.50" class="stars-cluster stars-cluster-2">
        <div class="star star-1"></div>
        <div class="star star-2"></div>
        <div class="star star-3"></div>
        <div class="star star-4"></div>
        <div class="star star-5"></div>
        <div class="star star-6"></div>
        <div class="star star-7"></div>
        <div class="star star-8"></div>
        <div class="star star-9"></div>
        <div class="star star-10"></div>
        <div class="star star-11"></div>
        <div class="star star-12"></div>
        <div class="star star-13"></div>
        <div class="star star-14"></div>
        <div class="star star-15"></div>
        <div class="star star-16"></div>
        <div class="star star-17"></div>
        <div class="star star-18"></div>
        <div class="star star-19"></div>
        <div class="star star-20"></div>
        <div class="star star-21"></div>
        <div class="star star-22"></div>
        <div class="star star-23"></div>
        <div class="star star-24"></div>
        <div class="star star-25"></div>
        <div class="star star-26"></div>
        <div class="star star-27"></div>
        <div class="star star-28"></div>
        <div class="star star-29"></div>
        <div class="star star-30"></div>
        <div class="star star-31"></div>
        <div class="star star-32"></div>
        <div class="star star-33"></div>
        <div class="star star-34"></div>
        <div class="star star-35"></div>
        <div class="star star-36"></div>
        <div class="star star-37"></div>
        <div class="star star-38"></div>
        <div class="star star-39"></div>
        <div class="star star-40"></div>
      </div>
      <div data-depth="0.90" class="stars-cluster stars-cluster-3">
        <div class="star star-1"></div>
        <div class="star star-2"></div>
        <div class="star star-3"></div>
        <div class="star star-4"></div>
        <div class="star star-5"></div>
        <div class="star star-6"></div>
        <div class="star star-7"></div>
        <div class="star star-8"></div>
        <div class="star star-9"></div>
        <div class="star star-10"></div>
        <div class="star star-11"></div>
        <div class="star star-12"></div>
        <div class="star star-13"></div>
        <div class="star star-14"></div>
        <div class="star star-15"></div>
      </div>
    </div>
	<!-- 背景结束了 -->
	
    <div class="fcmusic">
      <div class="items-group">
        <div class="item active">
          <div class="block" id="fcmusic">
            <span class="circleLight"></span>
            <div class="text">
              <span id="mybtn" class="icon">
                <img src="music_files/2.png" id="round_icon" class="round_icon play-tx"></span>
              <span id="tools">
                <i class="fa fa-backward play-left"></i>
                <i class="fa fa fa-play-circle play"></i>
                <i class="fa fa-forward play-right"></i>
                <br><br>
                <hr >
              </span>

              <p class="songtext">
			    <b class="songname" id="lyctext">听音识曲 - bingoabin</b>
              </p>			  
              <div class="scale_panel">
                <div class="scale" id="progressBar">
                  <div></div>
                  <span id="progressBtn"></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

</body></html>
<!--<p>
			在谷歌浏览器地址栏中输入“chrome://flags/#unsafely-treat-insecure-origin-as-secure”，回车如下图，<br/>
			<img src="imgs/detail.png"/><br/>
			将该选项置为Enabled，在输入框中输入需要访问的地址http://weiboss.net/m然后点击右下角弹出的Relaunch按钮，
			自动重启浏览器之后就可以在添加的http地址下调用摄像头和麦克风了。
		</p>-->

<script src="music_files/recorder.js" type="text/javascript" charset="utf-8"></script>
<script>
  //let recorder = new Recorder();
  let recorder = new Recorder({
    sampleBits: 16,                 // 采样位数，支持 8 或 16，默认是16
    sampleRate: 16000,              // 采样率，支持 11025、16000、22050、24000、44100、48000，根据浏览器默认值，我的chrome是48000
    numChannels: 1,                 // 声道，支持 1 或 2， 默认是1
    // compiling: false,(0.x版本中生效,1.x增加中)  // 是否边录边转换，默认是false
  });

  var audio = document.querySelector('audio');
  var i=1;
  $(function(){
    $("#mybtn").click(function() {
      if(i==1){
        $("#round_icon").attr("src","music_files/2.png");
        i++;
        recorder.start();
        $("#lyctext").html("听歌中 - bingoabin");
      }else if(i==2){
        i=1;
        recorder.stop();
        var blob = recorder.getWAVBlob();
        var form=new FormData();
        form.append("audioData",blob);
        $.ajax({
          url:"uploadSong" //上传到服务器的处理地址
          ,type:"POST"
          ,contentType:false //让xhr自动处理Content-Type header，multipart/form-data需要生成随机的boundary
          ,processData:false //不要处理data，让xhr自动处理
          ,data:form
          ,success:function(data){
            $("#lyctext").html("识别中 - bingoabin");
            $("#round_icon").attr("src","music_files/1.png");
            $.post("searchMusic",
                    function(data){
                      if(data.desc=='success'){
                        var arr=data.data;
                        for(var i=0;i<arr.length;i++){
                          console.log("歌曲名称："+arr[i].song+"-----歌手："+arr[i].singer);
                        }
                        for(var i=0;i<1;i++){
                          var song=arr[i].song;
                          var singer=arr[i].singer;
                          var msg='识别成功：<a style="color:#fff; display:inline-block; position:relative; z-index:999" href="https://music.163.com/#/search/m/?s='+song+' '+singer+'" target="_blank">'+singer+' - '+song+'</a>';
                          $("#round_icon").attr("src","music_files/4.png");
                          $("#lyctext").html(msg+"<br/>bingoabin");
                        }
                      }/*else if(data.code!=0){
                        $("#lyctext").html("识别失败 - bingoabin");
                      }*/else{
                        $("#round_icon").attr("src","music_files/3.png");
                        $("#lyctext").html("识别失败 - bingoabin");
                      }
                      i=1;
                    }, "json");
          }
          ,error:function(data){
            console.error("上传失败",data);
          }
        });
      }
    });
  });
</script>